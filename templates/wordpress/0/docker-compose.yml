version: '2'

services:

  wordpress:
    image: ohmydocker/docker-wordpress-wp-cli
    labels:
      io.rancher.sidekicks: db,wordpress-datavolume
      io.rancher.container.pull_image: always
    ports:
      - ${PUBLIC_PORT}:80
    links:
      - db
    volumes_from:
      - wordpress-datavolume
    restart: always

  db:
    restart: always
    image: mariadb
    volumes_from:
    - wordpress-datavolume
    labels:
      io.rancher.sidekicks: wordpress-datavolume
    environment:
    - MYSQL_USER=${DB_USER}
    - MYSQL_PASSWORD=${DB_PASS}
    - MYSQL_ROOT_PASSWORD=${DB_PASS}
    - MYSQL_DATABASE=${DB_NAME}

  wordpress-datavolume:
    image: "busybox"
    volume_driver: ${VOLUME_DRIVER}
    volumes:
      - ${VOLUME_NAME}:/var/www/wordpress
      - ${DB_VOLUME_NAME}:/var/lib/mysql
    labels:
      io.rancher.container.start_once: true
    entrypoint: ["/bin/true"]
